<!DOCTYPE html>
<html lang="pt">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Change GTKFileChooser to KDE Dolphin file chooser in Arch Linux | max dev blog & other stuff</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="/css/bootstrap-3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/main.css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->

    <link rel="shortcut icon" href="/images/favicon.jpg">

    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed/"> 

</head>


    <body>
      <div class="container">

        <header class="row">
  <div class="col-lg-8 col-lg-offset-2">
    <div class="row">
      <div class="col-lg-2 col-lg-offset-10">
        <select class="style-select" id="style-selector" name="stylesheet">
          <option value="dark">Dark mode</option>
          <option value="light">Light mode</option>
        </select>
      </div>
    </div>
    <h1 class="">max dev blog & other stuff</h1>
    <p>
    <span class="reserved">char</span> name[<span class="number"></span>] = <span class="string">"maksymilian"</span>;
    </p>
    <p>
    <span class="reserved">char</span> surname[<span class="number"></span>] = <span class="string">"babarowski"</span>;
    </p>
    <p>
    <span class="reserved">char</span> github[<span class="number"></span>] = <span class="string">"k0mmsussert0d"</span>;
    </p>
    <br />
    <p>
    printf("<span class="string">repo: <a href="https://github.com/k0mmsussert0d" target="_blank">https://github.com/<span class="reserved">%s\n</span></span></a>", github);
    </p>
    <p>
    printf(<span class="string">"e-mail: <span class="reserved">%s</span>@<span class="reserved">%s</span>.pl<span class="reserved">\n</span>"</span>, name, surname);
    </p>
  </div>
</header>
<script type="text/javascript">
  let savedTheme = localStorage.getItem("data-theme");
  let selector = document.getElementById("style-selector");
  if (savedTheme) {
    document.body.setAttribute("data-theme", savedTheme);
    selector.value = savedTheme;
  }
  selector.addEventListener("change", function(event){
    if (event.target.value === 'light') {
      document.body.setAttribute('data-theme', 'light');
      localStorage.setItem("data-theme", "light");
    } else if (event.target.value === 'dark') {
      document.body.removeAttribute('data-theme');
      localStorage.setItem("data-theme", "dark");
    } else {
      console.error("lolwut");
    }
  })
</script>

<div class="row">
  <div class="col-lg-8 col-lg-offset-2">
    <div class="menu">
      <ul>
          <li><a href="/">home</a></li>
          <li><a href="/blog/">archive</a></li>
          <li><a href="/about/">about</a></li>
      </ul>
    </div>
  </div>
</div>



        <div class="row">
          <div class="col-lg-8 col-lg-offset-2">
            <main>
            <div class="post">

  <header class="post-header">
    <h1>Change GTKFileChooser to KDE Dolphin file chooser in Arch Linux</h1>
  </header>

  <article class="post-content">
  <div class="post">

  <header class="post-header">
    <p class="meta">
        Nov 7, 2021
        
        
        ‚Ä¢
        <span><a href="/category/#linux" class="reserved">linux</a>,</span><span><a href="/category/#arch" class="reserved">arch</a>,</span><span><a href="/category/#ricing" class="reserved">ricing</a></span>
    </p>
  </header>

  <article class="post-content">
  <p><img src="/images/2021/gtkfilechooser.png" alt="GTKFileChooser window" /></p>

<p>GTK, while being widely adopted and utilized by thousands of apps is still suffering from that unresolved <a href="https://gitlab.gnome.org/GNOME/gtk/-/issues/233">Add an ‚Äúicon view with thumbnails‚Äù[0]</a> issue that has been residing in the project bug tracker for over 17 years (at the time of writing this article, November 2021). Personally, I‚Äôve learned about it fairly recently reading <a href="https://jayfax.neocities.org/mediocrity/gnome-has-no-thumbnails-in-the-file-picker.html">the article comparing GtkFileChooser to a clogged toilet[1]</a>, which explains how the inconvenience caused by the issue mostly went unnoticed by many users (including me) for years. It seems like it was a turning point in the life of the issue, as now its presence is being brought up on almost a daily basis in many informal tech communities. Most often, the purpose is scapegoating GTK as an entirety. The reasoning is that if such a conceptually simple, UX-crucial and obviously present at any notable competitor feature cannot be implemented since almost beginning of the project, then something is seriously wrong with the project itself. Perhaps it‚Äôs a convoluted codebase, bad maintaining or inadequate concepts fossilized into the core of the project.</p>

<p>I had used GNOME as my DE for 4 years. This means I was obviously affected by the issue, but chose not to care about it for a while. Since a few months, I‚Äôve been using only WMs for my daily work, which gave me a bit more flexibility in choosing the tools I like. This post explains how I installed alternative file chooser and set it to be the default one first in Firefox and (almost) globally on my Arch Linux setup.</p>

<!--break-->

<h2 id="installing-dolphin">Installing Dolphin</h2>

<p>A brief research conducts GNOME competitor ‚Äì KDE includes a file chooser with said functionality implemented. File chooser is actually a part of KDE‚Äôs default file manager called <a href="https://apps.kde.org/dolphin/">Dolphin[2]</a>.</p>

<p>It can be installed on Arch as a separate package (without KDE and most of the dependencies). In my case, it required these dependencies to be installed:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo pacman -S dolphin
resolving dependencies...
:: There are 2 providers available for phonon-qt5-backend:
:: Repository extra
   1) phonon-qt5-gstreamer  2) phonon-qt5-vlc

Enter a number (default=1): 1
looking for conflicting packages...
warning: dependency cycle detected:
warning: usbmuxd will be installed before its libimobiledevice dependency
warning: dependency cycle detected:
warning: phonon-qt5-gstreamer will be installed before its phonon-qt5 dependency

Packages (82) attica-5.87.0-1  baloo-5.87.0-1  baloo-widgets-21.08.3-1  cdparanoia-10.2-8
              convertlit-1.8-10  dmraid-1.0.0.rc16.3-13  dosfstools-4.2-1
              ebook-tools-0.2.2-7  exiv2-0.27.5-1  gptfdisk-1.0.8-1
              gst-plugins-base-1.18.5-1  kactivities-5.87.0-1  karchive-5.87.0-1
              kauth-5.87.0-1  kbookmarks-5.87.0-1  kcmutils-5.87.0-1  kcodecs-5.87.0-1
              kcompletion-5.87.0-1  kconfig-5.87.0-1  kconfigwidgets-5.87.0-1
              kcoreaddons-5.87.0-1  kcrash-5.87.0-1  kdbusaddons-5.87.0-1
              kdeclarative-5.87.0-1  kded-5.87.0-1  kdnssd-5.87.0-1  kdsoap-2.0.0-1
              kdsoap-ws-discovery-client-git20200927-2  kfilemetadata-5.87.0-1
              kglobalaccel-5.87.0-1  kguiaddons-5.87.0-1  ki18n-5.87.0-1
              kiconthemes-5.87.0-1  kidletime-5.87.0-1  kio-5.87.0-1  kio-extras-21.08.3-1
              kitemviews-5.87.0-1  kjobwidgets-5.87.0-1  knewstuff-5.87.0-1
              knotifications-5.87.0-1  kpackage-5.87.0-1  kparts-5.87.0-1  kservice-5.87.0-1
              ktextwidgets-5.87.0-1  kuserfeedback-1.0.0-1  kwallet-5.87.0-1
              kwidgetsaddons-5.87.0-1  kwindowsystem-5.87.0-1  kxmlgui-5.87.0-1
              libatasmart-0.19-5  libblockdev-2.26-1  libbytesize-2.6-1
              libimobiledevice-1.3.0-3  libinih-53-1  libmtp-1.1.19-1  libplist-2.2.0-3
              libtommath-1.2.0-3  libusbmuxd-2.0.2-1  libvisual-0.4.0-8  libyaml-0.2.5-1
              libzip-1.8.0-1  mdadm-4.1-2  media-player-info-24-2  ndctl-71.1-1  parted-3.4-2
              phonon-qt5-4.11.1-2  phonon-qt5-gstreamer-4.10.0-2  polkit-qt5-0.114.0-1
              poppler-qt5-21.11.0-1  qt5-multimedia-5.15.2-1  qt5-speech-5.15.2-1
              solid-5.87.0-1  sonnet-5.87.0-1  syndication-5.87.0-1
              syntax-highlighting-5.87.0-2  taglib-1.12-1  udisks2-2.9.4-1  upower-0.99.13-1
              usbmuxd-1.1.1-1  volume_key-0.3.12-5  xfsprogs-5.13.0-1  dolphin-21.08.3-1

Total Download Size:    53.64 MiB
Total Installed Size:  200.73 MiB
</code></pre></div></div>

<p>Those caring about ‚Äúnot bloating screenfetch‚Äù might stop reading right here. I don‚Äôt belong to that clique, and just continue.</p>

<h2 id="enabling-dolphin-as-default-file-chooser">Enabling Dolphin as default file chooser</h2>

<p>Now Dolphin is installed, but other applications needs to be instructed to use its component instead of GtkFileChooser. Unfortunately, whether GTK application is able to use alternative system dialogs or not depends on it implementing <code class="language-plaintext highlighter-rouge">xdg-desktop-portal</code> front-end service. Good portion of modern software does it, but be prepared to keep using GtkFileChooser in some apps.</p>

<p>Install packages <code class="language-plaintext highlighter-rouge">xdg-desktop-portal xdg-desktop-portal-kde</code>. Set environment variable <code class="language-plaintext highlighter-rouge">GTK_USE_PORTAL=1</code> in <code class="language-plaintext highlighter-rouge">/etc/environment</code> to apply this solution globally, or in <code class="language-plaintext highlighter-rouge">~/.bash_profile</code> to apply it for a user<a href="https://wiki.archlinux.org/title/Uniform_look_for_Qt_and_GTK_applications#Consistent_file_dialog">[3]</a>.</p>

<p>Reload session (log out and in). You should now be greeted with Dolphin file chooser in Firefox:
<img src="/images/2021/dolphinfilechooser.png" alt="Dolphin file chooser window" /></p>

<p>Some other apps I use on a daily basis started using Dolphin instead of GTK file chooser out of a box:</p>
<ul>
  <li>Chromium</li>
  <li>telegram-desktop</li>
</ul>

<p>And some didn‚Äôt change their behavior:</p>
<ul>
  <li>Discord (GTK)</li>
  <li>VSCode (GTK)</li>
  <li>KeePassXC (Qt)</li>
</ul>

<p>Let‚Äôs try briefly checking what‚Äôs the problem with each of them.</p>

<h3 id="electron-apps-support-xdg_desktop_portal-since-14">Electron apps support XDG_DESKTOP_PORTAL since 14</h3>

<p>Support for XDG_DESKTOP_PORTAL has been <a href="https://github.com/electron/electron/pull/19159">merged to Electron in April 2021[4]</a>, however it was evaluated as not stable enough to be introduced in 13.x version and postponed for the release of Electron 14. <a href="https://github.com/electron/electron/releases/tag/v14.0.0">The release happened on 31th August, 2021[5]</a>. Given the amount of time passed since then, it‚Äôs no wonder that few apps moved to Electron 14 from earlier versions.</p>

<p>In case of VSCode, a version of Electron it‚Äôs running on can be easily checked by opening developer console (Help &gt; Toggle Developer Options) and executing:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; process.versions.electron
&lt; "13.5.1"
</code></pre></div></div>

<p>As for now, neither Arch Linux package repositories or AUR provide any flavor of VSCode built with Electron 14. The only solution appears to be <a href="https://github.com/Microsoft/vscode/wiki/How-to-Contribute#build-and-run">building VSCode from scratch with custom internals[6]</a>. To me, it‚Äôs not worth the hassle and I‚Äôm going to just wait for VSCode to adopt Electron 14.</p>

<p>I had found no way of checking version of Electron Discord is running on, but I strongly suspect it‚Äôs the same cause as in VSCode case.</p>

<h3 id="qt-uses-qfiledialog">Qt uses QFileDialog</h3>

<p>And it seems to suffer from the same issue, as GTKFileChooser.</p>

<p><img src="/images/2021/qfiledialog.png" alt="QFileDialog window" /></p>

<p><a href="https://docs.flatpak.org/en/latest/portals-qt.html">Running Qt in Flatpak Sandbox might mitigate the issue[7]</a>. Debian provides this functionality on Flatpak/Snap based environments with <a href="https://packages.debian.org/bullseye/qt5-xdgdesktopportal-platformtheme"><code class="language-plaintext highlighter-rouge">qt5-xdgdesktopportal-platformtheme</code>[8]</a>.</p>

<p>Unfortunately, I found no solution applicable for my setup.</p>

<h2 id="tweaking-file-chooser">Tweaking file chooser</h2>

<p>Dolphin file chooser works wherever it‚Äôs possible now. But it still suffers from some caveats. Let‚Äôs go through the list and try to fix them.</p>

<h3 id="firefox-continuously-asks-to-be-set-as-default-browser-upon-launch">Firefox continuously asks to be set as default browser upon launch</h3>
<p>Setting <code class="language-plaintext highlighter-rouge">XDG_DESKTOP_PORTAL=1</code> triggers another, long-lasting <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1516290">bug[9]</a>. This time, it affects Mozilla Firefox. It can be silenced by setting <code class="language-plaintext highlighter-rouge">browser.shell.checkDefaultBrowser</code> to <code class="language-plaintext highlighter-rouge">false</code> in <code class="language-plaintext highlighter-rouge">about:config</code>. Essentially equivalent of just going to <em>Settings</em> page and unchecking <em>Always check if Firefox is your default browser</em>.</p>

<h3 id="thumbnails-for-other-media-types">Thumbnails for other media types</h3>

<p>Out of a box, Dolphin file chooser renders thumbnails for most of image file types. However, it‚Äôs not capable of generating thumbnails for videos.</p>

<p><img src="/images/2021/novideothumbs.png" alt="Dolphin file chooser window showing video files with no thumbnails" /></p>

<p>Install optional dependency <code class="language-plaintext highlighter-rouge">ffmpegthumbs</code>. This provides functionality of rendering thumbnails for most video files.</p>

<p>You might be tempted to install other optional dependencies, like <code class="language-plaintext highlighter-rouge">kdegraphics-thumbnailers</code> or <code class="language-plaintext highlighter-rouge">taglib</code> for generating thumbnails for other types of files. Keep in mind they work in main Dolphin file browser, not in the file chooser. Unless you‚Äôre going to use Dolphin file browser itself, installing them doesn‚Äôt make any difference.</p>

<h3 id="icons">Icons</h3>

<p>Dolphin installed separately from KDE does not feature themes. To use default icons set, install package <code class="language-plaintext highlighter-rouge">breeze-icons</code>.</p>

<h3 id="dark-theme-partially">Dark theme (partially)</h3>

<p>Default theme of Dolphin file chooser is bright and it might not fit well with dark-color rices. While changing theme for Dolphin file browser is possible through Qt5 settings, <del>theme settings do not apply to the file chooser</del>.</p>

<p><em>UPDATE: It took several reboots for the file chooser to start respecting dark Qt5 theme, however I don‚Äôt know cause behind this behavior. Feel free to follow instructions below and it might work for you out-of-the-box or after a few days of some sort of transition.</em></p>

<p>Changing Qt5 apps theme without KDE Plasma is somewhat challenging on its own, so I‚Äôll explain the method I used, but unfortunately it won‚Äôt be any of help for file chooser color scheme.</p>

<p>Install <code class="language-plaintext highlighter-rouge">breeze</code>, <code class="language-plaintext highlighter-rouge">qt5ct</code> and run it. If you see a warning about program not properly configured, set <code class="language-plaintext highlighter-rouge">QT_QPA_PLATFORMTHEME=qt5ct</code> environment variable and run it again.</p>

<p>In the <em>Appearance</em> tab, select style <em>Breeze</em> and custom <em>Palette</em> called <em>darker</em>. Click <em>Ok</em> and re-run Dolphin.</p>

<p>It‚Äôs going to look pretty bad now. While most of the interface now has dark theme applied, background is solid white. Exit Dolphin and edit <code class="language-plaintext highlighter-rouge">~/.config/kdeglobals</code> file adding:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[Colors:View]
BackgroundNormal=23,23,24
</code></pre></div></div>
<p>(this setting might already be there, just replace the value then)</p>

<p>Use RGB format for any color you like.</p>

<p>To make GTK theme match new Breeze Darker, install <code class="language-plaintext highlighter-rouge">breeze-gtk</code>. You can set it using a convenient GUI called <code class="language-plaintext highlighter-rouge">lxappearance</code>.</p>

<h2 id="alternatives">Alternatives</h2>

<p>GNOME‚Äôs powerlessness in fixing this bug yielded many unofficial, fork- or plugin-based solutions. To name one, <code class="language-plaintext highlighter-rouge">gtk3-patched-filechooser-icon-view</code> is available in AUR. If you‚Äôre all fine with GTK file chooser except for thumbnails matter, this might be a way to go. Personally, I find Dolphin file chooser much more appealing (even in its bright outfit) and admire UI transparency with full-fledged customization options. My recommendation is to try it out. In case you don‚Äôt like, just revert back to GTK.</p>

<h2 id="links">Links</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[0]: https://gitlab.gnome.org/GNOME/gtk/-/issues/233
[1]: https://jayfax.neocities.org/mediocrity/gnome-has-no-thumbnails-in-the-file-picker.html
[2]: https://apps.kde.org/dolphin/
[3]: https://wiki.archlinux.org/title/Uniform_look_for_Qt_and_GTK_applications#Consistent_file_dialog
[4]: https://github.com/electron/electron/pull/19159
[5]: https://github.com/electron/electron/releases/tag/v14.0.0
[6]: https://github.com/Microsoft/vscode/wiki/How-to-Contribute#build-and-run
[7]: https://docs.flatpak.org/en/latest/portals-qt.html
[8]: https://packages.debian.org/bullseye/qt5-xdgdesktopportal-platformtheme
[9]: https://bugzilla.mozilla.org/show_bug.cgi?id=1516290
</code></pre></div></div>

<p>~~~</p>

  </article>

	<p class="feed-recomendation">
		üíû Did you like the post? Add my blog to your RSS feed! <a href="/feed/">[click]</a> üíû
	</p>

  <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = '';
    var disqus_config = function () {
        this.page.identifier = "/blog/change-gtk-file-picker-to-kde-dolphin/";
    };
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>




</div>

  </article>

</div>

            </main>
          </div>
        </div>

        <div class="row">
  <div class="col-lg-8 col-lg-offset-2">
    <footer>
      Thx!
    </footer>
  </div>
</div>


      </div>
    </body>
</html>
